<!DOCTYPE HTML>
<html>
	<head>
		<title>Node Scrim</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<script src="../js/jquery.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<link href="http://www.picnicss.com/nut/picnic_3_2+nav+modal_2.min.css" rel="stylesheet" type="text/css">

		<style type="text/css">
			body {
				padding:50px;
			}

			ul {
				list-style-type: none;
			}

			ul li img:hover {
				border-style: solid;
				border-color: red;
				border-right-width: 1px;
				border-left-width: 1px;
			}

			.banned {
				opacity: 0.5;
			}

			#chatbox {
				border-style: solid;
				border-width: 2px;
				border-color: #F5F5F5;
				border-radius: 5px;
				padding:5px;
			}

			#chat {
				background-color:#FAFAFA;
			}

			#error {
				display: none;
				background-color:red;
			}
		</style>

		<script type="text/javascript">
			var chat = io.connect('http://localhost:8080/chat');
			var permission = false;
			var userName;
			var roomIdLength = 5;

			chat.emit('joinRoom', { url : document.URL.substring(document.URL.length-roomIdLength)} );

			chat.on('response', function(data) {
				$("#chat").append(data.name + ": " + data.content + "</br>");
			});

			chat.on('errorCode', function(data) {
				$("#error").css('display', 'block');
				switch(data.statusCode) {
					case 0: $("#error").html("Room is currently occupied, please navigate to a different room."); break;
					case 1: $("#error").html("Room does not currently exist, please navigate to the home page."); break;
				}
			});

			chat.on('updateClients', function(data) {

				$("#clientPool").empty();
				$.each(data.clients, function(k, v) {
					$("#clientPool").append("<li>" + v + "</li>");
				});
			});

			$(document).ready(function() {
				$("#messaging").hide();

				$("li img").click(function() {
					if(permission) {
						$(this).addClass("banned");
					}
				});

				$("#submit").click(function() {
					chat.emit('message', {
						name : $("#name").val(),
						content : $("#textinput").val()
					});
				})

				$("#setName").click(function() {
					userName = $("#name").val();

					chat.emit('register', {
						name : userName
					});
					$("#naming").hide();
					$("#messaging").show();
				})
			});
		</script>
	</head>
	<body>
		<div id="error" class="error">
			<center></center>
		</div>
		<div class="row">
			<div class="container">
				<div id="chatbox">
					<div id="chat" style="height:480px;overflow-x:hidden; overflow-y:scroll;">

					</div>
					<div id="messageSection" >
						<div id="naming">
														<input type="text" id="name" />
							<button id="setName">Set</button>
						</div>
						<div id="messaging">
							<label>Message:</label>
							<input type="text" id="textinput" />
							<input type="submit" id="submit" value="Submit" />
						</div>
					</div>
				</div>
			</div>
			
			<div class="row">
				<div>
					<ul id="clientPool">

					</ul>
				</div>
				<div></div>
				<div>
					<ul id="serverPool">
						<li><div class="button">New York</div></li>
						<li><div class="button">San Francisco</div></li>
						<li><div class="button">Amsterdam</div></li>
						<li><div class="button">London</div></li>
					</ul>
				</div>
			</div>
			<div>
				<ul id="mapPool">
					<li><img src="../images/dust2.png" /></li>
					<li><img src="../images/mirage.png" /></li>
					<li><img src="../images/cache.png" /></li>
					<li><img src="../images/cbble.png" /></li>
					<li><img src="../images/overpass.png" /></li>
					<li><img src="../images/train.png" /></li>
					<li><img src="../images/inferno.png" /></li>
				</ul>
			</div>
		</div>
	</body>
</html>
